<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinFreedom - Tu Libertad Financiera</title>
    
    <!-- 1. React & ReactDOM (Core) -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    
    <!-- 2. Prop Types (Necesario para Recharts) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- 3. Recharts (Gráficos) -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    
    <!-- 4. Babel (Compilador JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 5. Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        lilac: { 50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95' },
                        beige: { 50: '#fdfcf8', 100: '#f5f5f4', 200: '#e7e5e4', 300: '#d6d3d1', 800: '#292524' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #fdfcf8; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        /* Fallback for error handling */
        #error-container { display: none; padding: 20px; background: #fee2e2; color: #b91c1c; border: 1px solid #f87171; margin: 20px; border-radius: 8px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="error-container"></div>

    <script type="text/babel">
        // --- DEFINICIÓN DE ICONOS SVG (Para evitar errores de carga externa) ---
        const IconBase = ({ d, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                <path d={d} />
            </svg>
        );

        const Icons = {
            Target: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            TrendingUp: (props) => <IconBase d="M22 7L13.5 15.5L8.5 10.5L2 17M22 7H16M22 7V13" {...props} />,
            Wallet: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>,
            PieChart: (props) => <IconBase d="M21.21 15.89A10 10 0 1 1 8 2.83M22 12A10 10 0 0 0 12 2v10z" {...props} />,
            DollarSign: (props) => <IconBase d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" {...props} />,
            ArrowRight: (props) => <IconBase d="M5 12h14M12 5l7 7-7 7" {...props} />,
            Plus: (props) => <IconBase d="M12 5v14M5 12h14" {...props} />,
            Trash2: (props) => <IconBase d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6" {...props} />,
            Shield: (props) => <IconBase d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" {...props} />,
            Activity: (props) => <IconBase d="M22 12h-4l-3 9L9 3l-3 9H2" {...props} />,
            Zap: (props) => <IconBase d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" {...props} />,
            Sparkles: (props) => <IconBase d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962l6.135-1.583A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0l1.582 6.135a2 2 0 0 0 1.437 1.437l6.135 1.583a.5.5 0 0 1 0 .962l-6.135 1.583a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z" {...props} />,
            X: (props) => <IconBase d="M18 6L6 18M6 6l12 12" {...props} />,
            Send: (props) => <IconBase d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" {...props} />,
            Lightbulb: (props) => <IconBase d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5" {...props} />,
            FileText: (props) => <IconBase d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zM14 2v6h6" {...props} />,
            Brain: (props) => <IconBase d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" {...props} />
        };

        // --- INICIO DE LA APP ---
        
        const { useState, useEffect, useMemo, useRef } = React;
        const { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend, LineChart, Line, XAxis, YAxis, CartesianGrid, AreaChart, Area } = Recharts;

        // API Key para Gemini (Dejar vacía para que el sistema inyecte, o usar propia para pruebas)
        const GEMINI_API_KEY = ""; 

        const callGeminiAPI = async (prompt) => {
            const apiKey = typeof GEMINI_API_KEY !== 'undefined' ? GEMINI_API_KEY : "";
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    }
                );
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Lo siento, no pude procesar la solicitud.";
            } catch (error) {
                console.error("Gemini Error:", error);
                return "Error de conexión con IA.";
            }
        };

        const COLORS = ['#8B5CF6', '#C4B5FD', '#FCD34D', '#FDA4AF', '#A78BFA', '#E5E7EB'];

        const RISK_PROFILES = {
            conservador: {
                label: 'Conservador',
                allocation: { fixed: 70, equity: 30 },
                avgReturn: 0.05, 
                description: 'Prioridad en preservar capital. Menor volatilidad.',
                icon: <Icons.Shield className="w-6 h-6 text-emerald-500" />
            },
            moderado: {
                label: 'Moderado',
                allocation: { fixed: 50, equity: 50 },
                avgReturn: 0.08, 
                description: 'Balance entre crecimiento y seguridad.',
                icon: <Icons.Activity className="w-6 h-6 text-purple-500" />
            },
            agresivo: {
                label: 'Agresivo',
                allocation: { fixed: 30, equity: 70 },
                avgReturn: 0.10, 
                description: 'Maximizar crecimiento a largo plazo. Mayor volatilidad.',
                icon: <Icons.Zap className="w-6 h-6 text-rose-500" />
            }
        };

        const EXPENSE_CATEGORIES = ['Vivienda', 'Alimentación', 'Transporte', 'Entretenimiento', 'Salud', 'Otros'];

        // --- Componentes ---

        const Card = ({ children, className = '' }) => (
            <div className={`bg-white rounded-2xl shadow-sm border border-stone-100 p-6 hover:shadow-md transition-shadow duration-300 ${className}`}>
                {children}
            </div>
        );

        const Button = ({ onClick, children, variant = 'primary', className = '', disabled = false, isLoading = false }) => {
            const baseStyle = "px-5 py-2.5 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-purple-600 text-white hover:bg-purple-700 shadow-lg shadow-purple-200 disabled:bg-purple-300",
                secondary: "bg-stone-100 text-stone-700 hover:bg-stone-200",
                outline: "border-2 border-stone-200 text-stone-600 hover:border-purple-500 hover:text-purple-600 bg-transparent",
                gemini: "bg-gradient-to-r from-purple-500 to-indigo-500 text-white hover:shadow-lg hover:shadow-indigo-200 border border-white/20"
            };
            return (
                <button onClick={onClick} disabled={disabled || isLoading} className={`${baseStyle} ${variants[variant]} ${className}`}>
                {isLoading ? <span className="animate-spin">⌛</span> : children}
                </button>
            );
        };

        const AIAssistant = ({ user, expenses, totalExpenses }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { type: 'bot', text: '¡Hola! Soy tu asistente financiero Gemini. ¿En qué puedo ayudarte?' }
            ]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);

            useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages, isOpen]);

            const handleSend = async () => {
                if (!input.trim()) return;
                const userMsg = { type: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsTyping(true);

                const context = `Usuario: ${user.name}, Riesgo: ${user.riskProfile}, Gastos: $${totalExpenses}. Pregunta: "${input}". Responde breve en español.`;
                const response = await callGeminiAPI(context);
                
                setIsTyping(false);
                setMessages(prev => [...prev, { type: 'bot', text: response }]);
            };

            if (!user.onboardingComplete) return null;

            return (
                <React.Fragment>
                    <button onClick={() => setIsOpen(!isOpen)} className={`fixed bottom-6 right-6 p-4 rounded-full shadow-2xl transition-all duration-300 z-50 flex items-center justify-center border-4 border-white ${isOpen ? 'bg-stone-800 rotate-90' : 'bg-gradient-to-tr from-purple-600 to-indigo-500 hover:scale-110 shadow-purple-300'}`}>
                        {isOpen ? <Icons.X className="text-white w-6 h-6" /> : <Icons.Sparkles className="text-white w-6 h-6 animate-pulse" />}
                    </button>
                    {isOpen && (
                        <div className="fixed bottom-24 right-6 w-80 md:w-96 h-[450px] bg-[#fdfcf8] rounded-3xl shadow-2xl border border-stone-100 z-50 flex flex-col overflow-hidden animate-in">
                            <div className="bg-white p-4 border-b border-stone-100 flex items-center gap-3">
                                <div className="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center"><Icons.Sparkles className="w-4 h-4 text-purple-600" /></div>
                                <h3 className="font-bold text-stone-800 text-sm">Asistente Gemini</h3>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-[#fdfcf8]">
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${msg.type === 'user' ? 'bg-purple-600 text-white rounded-br-none' : 'bg-white border border-stone-100 text-stone-700 rounded-bl-none'}`}>
                                            <div dangerouslySetInnerHTML={{ __html: msg.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br/>') }} />
                                        </div>
                                    </div>
                                ))}
                                {isTyping && <div className="text-xs text-stone-400 pl-4">Escribiendo...</div>}
                                <div ref={messagesEndRef} />
                            </div>
                            <div className="p-3 bg-white border-t border-stone-100 flex gap-2">
                                <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSend()} placeholder="Escribe..." className="flex-1 bg-stone-50 border-none rounded-xl px-4 py-2 text-sm outline-none" />
                                <button onClick={handleSend} disabled={isTyping} className="bg-purple-600 text-white p-2 rounded-xl"><Icons.Send className="w-4 h-4" /></button>
                            </div>
                        </div>
                    )}
                </React.Fragment>
            );
        };

        function App() {
            const [view, setView] = useState('onboarding'); 
            const [user, setUser] = useState({ name: '', initialInvestment: '', riskProfile: null, onboardingComplete: false });
            const [expenses, setExpenses] = useState([
                { id: 1, category: 'Vivienda', amount: 800, date: '2023-10-01' },
                { id: 2, category: 'Alimentación', amount: 450, date: '2023-10-05' },
                { id: 3, category: 'Transporte', amount: 200, date: '2023-10-10' },
            ]);
            const [newExpense, setNewExpense] = useState({ category: 'Alimentación', amount: '', date: new Date().toISOString().split('T')[0] });
            const [expenseReport, setExpenseReport] = useState(null);
            const [loadingReport, setLoadingReport] = useState(false);
            const [portfolioAdvice, setPortfolioAdvice] = useState(null);
            const [loadingAdvice, setLoadingAdvice] = useState(false);

            const totalExpenses = useMemo(() => expenses.reduce((acc, curr) => acc + Number(curr.amount), 0), [expenses]);
            const financialFreedomNumber = totalExpenses * 12 * 25; 
            const portfolioValue = Number(user.initialInvestment) || 0;
            
            const expenseData = useMemo(() => {
                const grouped = expenses.reduce((acc, curr) => { acc[curr.category] = (acc[curr.category] || 0) + Number(curr.amount); return acc; }, {});
                return Object.keys(grouped).map(key => ({ name: key, value: grouped[key] }));
            }, [expenses]);

            const projectionData = useMemo(() => {
                if (!user.riskProfile) return [];
                const years = 30;
                const data = [];
                const rate = RISK_PROFILES[user.riskProfile].avgReturn;
                const monthlyContribution = totalExpenses * 0.2; 
                let currentWealth = Number(user.initialInvestment);
                for (let i = 0; i <= years; i++) {
                    data.push({ year: `Año ${i}`, patrimonio: Math.round(currentWealth), meta: financialFreedomNumber });
                    currentWealth = (currentWealth + (monthlyContribution * 12)) * (1 + rate);
                }
                return data;
            }, [user.initialInvestment, user.riskProfile, totalExpenses, financialFreedomNumber]);

            const generateExpenseAudit = async () => {
                setLoadingReport(true);
                const res = await callGeminiAPI(`Audita estos gastos: ${JSON.stringify(expenses)}. Total: $${totalExpenses}. Da 3 consejos breves.`);
                setExpenseReport(res);
                setLoadingReport(false);
            };

            const generatePortfolioAdvice = async () => {
                setLoadingAdvice(true);
                const res = await callGeminiAPI(`Analiza perfil ${user.riskProfile}. Asignación: ${JSON.stringify(RISK_PROFILES[user.riskProfile].allocation)}. Ventajas y riesgos en 2 lineas.`);
                setPortfolioAdvice(res);
                setLoadingAdvice(false);
            };

            const handleOnboardingSubmit = () => { if (user.name && user.initialInvestment && user.riskProfile) { setUser({ ...user, onboardingComplete: true }); setView('dashboard'); } };
            const addExpense = (e) => { e.preventDefault(); if (!newExpense.amount) return; setExpenses([...expenses, { ...newExpense, id: Date.now(), amount: Number(newExpense.amount) }]); setNewExpense({ ...newExpense, amount: '' }); };
            const removeExpense = (id) => setExpenses(expenses.filter(exp => exp.id !== id));

            if (!user.onboardingComplete) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="max-w-2xl w-full bg-white rounded-3xl shadow-xl border border-stone-100 overflow-hidden">
                            <div className="bg-gradient-to-br from-purple-700 to-indigo-600 p-8 text-center text-white">
                                <h1 className="text-3xl font-bold flex items-center justify-center gap-2"><Icons.Target className="w-8 h-8" /> FinFreedom</h1>
                                <p className="opacity-90">Diseña tu tranquilidad financiera.</p>
                            </div>
                            <div className="p-8 space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" placeholder="Tu Nombre" className="p-3 border rounded-xl w-full" value={user.name} onChange={(e) => setUser({...user, name: e.target.value})} />
                                    <input type="number" placeholder="Inversión Inicial ($)" className="p-3 border rounded-xl w-full" value={user.initialInvestment} onChange={(e) => setUser({...user, initialInvestment: e.target.value})} />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    {Object.entries(RISK_PROFILES).map(([key, profile]) => (
                                        <button key={key} onClick={() => setUser({...user, riskProfile: key})} className={`p-4 rounded-xl border text-left transition-all ${user.riskProfile === key ? 'border-purple-500 bg-purple-50 ring-2 ring-purple-100' : 'hover:bg-stone-50'}`}>
                                            <div className="mb-2">{profile.icon}</div>
                                            <div className="font-bold text-sm">{profile.label}</div>
                                        </button>
                                    ))}
                                </div>
                                <Button onClick={handleOnboardingSubmit} disabled={!user.name || !user.initialInvestment || !user.riskProfile} className="w-full">Comenzar <Icons.ArrowRight className="w-4 h-4" /></Button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-[#fdfcf8] flex flex-col md:flex-row text-stone-800">
                    <aside className="w-full md:w-64 bg-white border-r border-stone-100 p-4 flex flex-col gap-2">
                        <h2 className="text-xl font-bold text-purple-700 flex items-center gap-2 mb-6 px-2"><Icons.Target className="w-6 h-6" /> FinFreedom</h2>
                        <button onClick={() => setView('dashboard')} className={`flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold ${view === 'dashboard' ? 'bg-purple-50 text-purple-700' : 'text-stone-500 hover:bg-stone-50'}`}><Icons.TrendingUp className="w-5 h-5" /> Dashboard</button>
                        <button onClick={() => setView('expenses')} className={`flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold ${view === 'expenses' ? 'bg-purple-50 text-purple-700' : 'text-stone-500 hover:bg-stone-50'}`}><Icons.Wallet className="w-5 h-5" /> Gastos</button>
                        <button onClick={() => setView('portfolio')} className={`flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold ${view === 'portfolio' ? 'bg-purple-50 text-purple-700' : 'text-stone-500 hover:bg-stone-50'}`}><Icons.PieChart className="w-5 h-5" /> Portafolio</button>
                    </aside>

                    <main className="flex-1 p-6 overflow-y-auto">
                        {view === 'dashboard' && (
                            <div className="space-y-6 animate-in">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <Card className="border-l-4 border-l-purple-400">
                                        <div className="text-stone-500 text-xs font-bold uppercase">Gastos Mensuales</div>
                                        <div className="text-2xl font-bold">${totalExpenses.toLocaleString()}</div>
                                    </Card>
                                    <Card className="border-l-4 border-l-emerald-400">
                                        <div className="text-stone-500 text-xs font-bold uppercase">Meta Libertad</div>
                                        <div className="text-2xl font-bold">${financialFreedomNumber.toLocaleString()}</div>
                                    </Card>
                                    <Card className="border-l-4 border-l-indigo-400">
                                        <div className="text-stone-500 text-xs font-bold uppercase">Progreso</div>
                                        <div className="text-2xl font-bold mb-1">{((portfolioValue / financialFreedomNumber) * 100).toFixed(2)}%</div>
                                        <div className="bg-stone-100 h-1.5 rounded-full"><div className="bg-indigo-500 h-full rounded-full" style={{width: `${Math.min(((portfolioValue / financialFreedomNumber) * 100), 100)}%`}}></div></div>
                                    </Card>
                                </div>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <Card>
                                        <h3 className="font-bold mb-4 flex gap-2"><Icons.TrendingUp className="w-5 h-5 text-purple-500" /> Proyección</h3>
                                        <div className="h-64"><ResponsiveContainer width="100%" height="100%"><AreaChart data={projectionData}><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="year" hide /><YAxis tickFormatter={(val)=>`$${val/1000}k`} /><Tooltip formatter={(val)=>`$${val.toLocaleString()}`} /><Area type="monotone" dataKey="patrimonio" stroke="#8B5CF6" fill="#8B5CF6" fillOpacity={0.2} /><Area type="monotone" dataKey="meta" stroke="#10B981" strokeDasharray="5 5" fill="none" /></AreaChart></ResponsiveContainer></div>
                                    </Card>
                                    <Card>
                                        <h3 className="font-bold mb-4 flex gap-2"><Icons.PieChart className="w-5 h-5 text-rose-500" /> Distribución</h3>
                                        <div className="h-64"><ResponsiveContainer width="100%" height="100%"><PieChart><Pie data={expenseData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value"><Cell fill="#8B5CF6"/><Cell fill="#FCD34D"/><Cell fill="#FDA4AF"/><Cell fill="#10B981"/></Pie><Tooltip /></PieChart></ResponsiveContainer></div>
                                    </Card>
                                </div>
                            </div>
                        )}

                        {view === 'expenses' && (
                            <div className="space-y-6 animate-in">
                                <div className="flex justify-between items-center bg-white p-4 rounded-xl border border-stone-100">
                                    <h1 className="font-bold text-xl">Gastos</h1>
                                    <Button variant="gemini" onClick={generateExpenseAudit} isLoading={loadingReport}><Icons.Sparkles className="w-4 h-4" /> Auditar</Button>
                                </div>
                                {expenseReport && <div className="bg-purple-50 p-4 rounded-xl border border-purple-100 text-sm whitespace-pre-line relative"><button onClick={() => setExpenseReport(null)} className="absolute top-2 right-2"><Icons.X className="w-4 h-4 text-purple-400" /></button><strong>Gemini:</strong> {expenseReport}</div>}
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    <Card className="h-fit">
                                        <form onSubmit={addExpense} className="space-y-4">
                                            <input type="number" placeholder="Monto" className="w-full p-3 border rounded-xl" value={newExpense.amount} onChange={e => setNewExpense({...newExpense, amount: e.target.value})} />
                                            <select className="w-full p-3 border rounded-xl bg-white" value={newExpense.category} onChange={e => setNewExpense({...newExpense, category: e.target.value})}>{EXPENSE_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}</select>
                                            <input type="date" className="w-full p-3 border rounded-xl" value={newExpense.date} onChange={e => setNewExpense({...newExpense, date: e.target.value})} />
                                            <Button type="submit" className="w-full"><Icons.Plus className="w-4 h-4" /> Agregar</Button>
                                        </form>
                                    </Card>
                                    <Card className="lg:col-span-2">
                                        <table className="w-full text-sm text-left">
                                            <thead className="text-stone-400 border-b"><tr className="h-10"><th>Cat</th><th>Fecha</th><th className="text-right">Monto</th><th></th></tr></thead>
                                            <tbody>{expenses.map(e => <tr key={e.id} className="h-12 border-b last:border-0"><td><span className="bg-stone-100 px-2 py-1 rounded font-bold">{e.category}</span></td><td className="text-stone-500">{e.date}</td><td className="text-right font-bold">${e.amount}</td><td className="text-center"><button onClick={() => removeExpense(e.id)} className="text-red-300 hover:text-red-500"><Icons.Trash2 className="w-4 h-4" /></button></td></tr>)}</tbody>
                                        </table>
                                    </Card>
                                </div>
                            </div>
                        )}

                        {view === 'portfolio' && (
                            <div className="space-y-6 animate-in">
                                <div className="flex justify-between items-center bg-white p-4 rounded-xl border border-stone-100">
                                    <h1 className="font-bold text-xl">Portafolio</h1>
                                    <Button variant="gemini" onClick={generatePortfolioAdvice} isLoading={loadingAdvice}><Icons.Brain className="w-4 h-4" /> Analizar</Button>
                                </div>
                                {portfolioAdvice && <div className="bg-stone-800 text-stone-200 p-4 rounded-xl text-sm whitespace-pre-line relative"><button onClick={() => setPortfolioAdvice(null)} className="absolute top-2 right-2 text-stone-500 hover:text-white"><Icons.X className="w-4 h-4" /></button><strong>Gemini Strategy:</strong> {portfolioAdvice}</div>}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <Card className="text-center">
                                        <div className="inline-block p-4 bg-purple-50 rounded-full mb-4">{RISK_PROFILES[user.riskProfile].icon}</div>
                                        <h2 className="text-2xl font-bold">{RISK_PROFILES[user.riskProfile].label}</h2>
                                        <p className="text-stone-500 mt-2">{RISK_PROFILES[user.riskProfile].description}</p>
                                    </Card>
                                    <Card className="flex flex-col justify-center items-center">
                                        <div className="w-full h-48"><ResponsiveContainer width="100%" height="100%"><PieChart><Pie data={[{name:'Acciones', value: RISK_PROFILES[user.riskProfile].allocation.equity}, {name:'Bonos', value: RISK_PROFILES[user.riskProfile].allocation.fixed}]} cx="50%" cy="50%" innerRadius={50} outerRadius={80} dataKey="value"><Cell fill="#8B5CF6"/><Cell fill="#10B981"/></Pie><Tooltip /></PieChart></ResponsiveContainer></div>
                                        <div className="flex gap-4 text-sm mt-4"><div className="flex items-center gap-1"><div className="w-3 h-3 bg-purple-500 rounded-full"></div>Acciones ({RISK_PROFILES[user.riskProfile].allocation.equity}%)</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-emerald-500 rounded-full"></div>Bonos ({RISK_PROFILES[user.riskProfile].allocation.fixed}%)</div></div>
                                    </Card>
                                </div>
                            </div>
                        )}
                    </main>
                    <AIAssistant user={user} expenses={expenses} totalExpenses={totalExpenses} />
                </div>
            );
        }

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        } catch (error) {
            document.getElementById('error-container').style.display = 'block';
            document.getElementById('error-container').innerText = 'Error crítico al iniciar: ' + error.message;
            console.error(error);
        }
    </script>
</body>
</html>